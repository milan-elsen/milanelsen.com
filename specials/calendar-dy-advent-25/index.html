<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advent Calendar</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    /* use Helvetica as requested */
    html, body {
      height: 100%;
      overscroll-behavior: none; /* prevent system rubberbanding */
    }

    body {
      font-family: Helvetica, "Helvetica Neue", Arial, system-ui, -apple-system;
      background: #ffffff;
      color: #111;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* spacer sets page height so vertical scroll maps to horizontal scroll */
    .spacer { width: 1px; height: 100vh; }

    /* fixed viewport ‚Äî page scroll drives horizontal scroll inside */

    .modal .modal-body {
      /* prevent breaking/wrapping ‚Äî prefer shrinking the font to fit horizontally */
      white-space: pre; /* preserve whitespace and prevent wrapping */
      overflow-wrap: normal;
      word-break: normal;
      overflow: hidden; /* we'll shrink text to fit; hide overflow rather than wrap */
      max-height: calc(86vh - 100px);
    }
    .viewport {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .container {
      width: 100%;
      height: 100vh;
      max-width: 420px;
      display: grid;
      grid-template-rows: 1fr 2fr; /* top 1/3, bottom 2/3 */
      align-items: start;
      pointer-events: auto;
      padding: calc(env(safe-area-inset-top, 12px) + 8px) 12px calc(env(safe-area-inset-bottom, 12px) + 12px);
      box-sizing: border-box;
    }

    .hero {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 6px 0 6px;
    }

    /* ornaments sized to match the title */
    .cybergoth-ornament {
      font-family: inherit;
      font-size: 18px; /* match h1.cybergoth */
      line-height: 1;
      margin: 6px 0;
      color: inherit;
      white-space: pre;
      text-align: center;
    }

    /* smaller monospaced ornament lines (typewriter style) */
    .cybergoth-ornament-mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      font-size: 12px;
      line-height: 1;
      margin: 4px 0;
      color: inherit;
      white-space: pre;
      text-align: center;
      letter-spacing: 0.2px;
      opacity: 0.95;
    }

    .cybergoth-ascii {
      /* enforce a true monospace stack and disable ligatures so characters align vertically */
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      white-space: pre;
      text-align: center;
      line-height: 1;
      margin: 8px 0 6px;
      color: #0a0a0a;
      opacity: 0.95;
      font-size: 12px;
      letter-spacing: 0; /* equal spacing per glyph */
      font-variant-ligatures: none;
      -webkit-font-feature-settings: "liga" 0;
      font-feature-settings: "liga" 0;
      hyphens: none;
    }

    h1.cybergoth {
      text-align: center;
      font-weight: 700;
      margin: 0 0 8px 0;
      font-size: 18px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #111;
    }

    .warning {
      display: none;
      border: 2px solid #000;
      background: #fff;
      color: #000;
      padding: 10px 12px;
      font-size: 13px;
      text-align: center;
      margin: 12px;
    }

    /* horizontal scroll wrapper ‚Äî top padding so grid sits in the bottom ~2/3 of the viewport */
    .scroll-wrap {
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      touch-action: pan-y;
      width: 100%;
      display: flex;
      align-items: stretch;
      /* top padding removed ‚Äî layout now driven by the parent grid.
         Keep a small bottom padding to avoid on-screen bars. */
      padding: 12px 0 calc(env(safe-area-inset-bottom, 12px) + 12px);
      pointer-events: auto;

      /* hide native scrollbars */
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .scroll-wrap::-webkit-scrollbar { height: 0; width: 0; display: none; }

    /* ensure no visible scrollbars anywhere (overlay scrollbars, browsers) */
    html::-webkit-scrollbar, body::-webkit-scrollbar { display: none; width: 0; height: 0; }
    html, body { scrollbar-width: none; -ms-overflow-style: none; }

    /* three rows, column flow; grid-auto-columns controlled by JS via --cell-size */
    .calendar {
      display: grid;
      /* use dense packing to backfill gaps created by spanning tiles */
      grid-auto-flow: column dense;
      grid-template-rows: repeat(3, var(--cell-size, 120px));
      grid-auto-columns: var(--cell-size, 120px);
      gap: 10px;
      align-items: stretch;
      width: max-content;
      /* fill available area of the bottom grid row (2/3 of container) */
      height: 100%;
      /* place calendar toward the bottom of its grid area to reduce whitespace below */
      align-self: end;
      margin-bottom: 8px;
    }

    /* square tiles using computed cell size */
    .door {
      -webkit-appearance: none;
      appearance: none;
      background: #fff;
      border: 2px solid #000;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
      color: #000;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms;
      user-select: none;
      text-align: center;
      width: var(--cell-size, 120px);
      height: var(--cell-size, 120px);
      pointer-events: auto;
      box-sizing: border-box;
    }

    .door:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.06); }
    .door:focus { outline: 3px solid rgba(0,0,0,0.08); outline-offset: 2px; }

    /* larger square breakers: span 2x2 */
    .span-2x2 { grid-column: span 2; grid-row: span 2; width: calc(var(--cell-size,120px) * 2 + 10px); height: calc(var(--cell-size,120px) * 2 + 10px); }

    /* allow some tiles to span 1x2 or 2x1 if desired (keeps rectangular breakouts) */
    .span-row-2 { grid-row: span 2; height: calc(var(--cell-size,120px) * 2 + 10px); }
    .span-col-2 { grid-column: span 2; width: calc(var(--cell-size,120px) * 2 + 10px); }

    .door:disabled { opacity: 0.55; cursor: default; transform: none; box-shadow: none; pointer-events: none; }

    .door.opened { color: #fff; border-color: #000; background: #000; transform: none; opacity: 1; }

    .calendar:focus { outline: none; }

    /* --- modal styles for content behind doors --- */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }
    .modal {
      background: #fff;
      color: #111;
      max-width: 92vw;
      max-height: 86vh;
      width: 420px;
      border: 2px solid #000;
      box-sizing: border-box;
      padding: 14px;
      /* prevent native scrolling; we'll shrink text to fit when needed */
      overflow: hidden;
      position: relative;
    }
    .modal .modal-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .modal .modal-title {
      font-weight: 700;
      margin-bottom: 8px;
      text-transform: uppercase;
      font-size: 14px;
    }
    .modal .modal-body img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .modal .modal-body a {
      color: #0066cc;
      word-break: break-word;
    }
    .modal .modal-body p {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="spacer" id="spacer"></div>

  <div class="viewport" id="viewport">
    <div class="container">
      <div class="hero">
      <div id="warning" class="warning" role="status" aria-live="polite">
        For the intended experience open this on a phone.
      </div>
      <pre class="cybergoth-ornament" aria-hidden="true">‚âΩ^‚Ä¢ Àï ‚Ä¢ ‡æÄ‡Ω≤‚âº</pre>
      <h1 id="title" class="cybergoth">D ‡æÄ‡Ω≤‡æÄ‡Ω≤·®µ◊Å◊Öùï£…ë◊Å◊Ö÷ÆÍØ±◊Å◊Ö÷í A’™◊Å◊Ö›ä·•é◊Å◊ÖÍ´∂Í´Ä◊Å◊Ö‹ªÍ™Ä◊Å◊Öt◊Å◊ÖÍØ±◊Å◊Ö÷í∆ô◊Å◊Ö÷ë…ë◊Å◊Ö÷Æ·•£◊Å◊Ö÷™Í´Ä◊Å◊Ö‹ªÍ™Ä◊Å◊Ö’™◊Å◊Ö›äÍ´Ä◊Å◊Ö‹ªùï£</h1>
      <pre class="cybergoth-ornament cybergoth-ornament-mono" aria-hidden="true">‚ãÜÀñ‚Å∫‚Äß‚Çä‚òΩvon milan‚òæ‚Çä‚Äß‚Å∫Àñ‚ãÜ</pre>
      <pre class="cybergoth-ornament cybergoth-ornament-mono" aria-hidden="true">.À≥¬∑Àñ‚ú∂ f√ºr doraüéÄ ‚ú∂Àñ¬∑À≥.</pre>
      <pre class="cybergoth-ascii" aria-hidden="true">
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°¥‚£Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚£ø‚°ó‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚£†‚†ü‚†Ä‚†ò‚†∑‚†∂‚†∂‚†∂‚†æ‚†â‚¢≥‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ß‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚£∞‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚£§‚£§‚£§‚£§‚£§‚£ø‚¢ø‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚£∑‚°¥‚†∂‚£¶
‚†Ä‚†Ä‚¢±‚°Ä‚†Ä‚†â‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†õ‚†É‚†Ä‚¢†‚°ü‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£†‚£§‚†ø‚†û‚†õ‚†ã
‚£†‚†æ‚†ã‚†ô‚£∂‚£§‚£§‚£§‚£§‚£§‚£Ä‚£†‚£§‚£æ‚£ø‚†¥‚†∂‚†ö‚†ã‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†õ‚†í‚†õ‚†â‚†â‚†Ä‚†Ä‚†Ä‚£¥‚†ü‚¢É‚°¥‚†õ‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†õ‚†õ‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
</pre>

      </div>

      <div class="scroll-wrap" id="scrollWrap" aria-hidden="false">
        <div class="calendar" id="calendar" aria-label="Advent calendar"></div>
      </div>
      <pre class="cybergoth-ornament" aria-hidden="true">‚ùÜ*‚îÅ‚îÅ‚îÅ‚îÅ ï‚Ä¢„â®‚Ä¢ î‚îÅ‚îÅ‚îÅ‚îÅ*‚ùÜ</pre>
    </div>
  </div>

  <!-- modal markup for door contents -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="modal-close" id="modalClose" aria-label="Close">‚úï</button>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    (function () {
      const calendar = document.getElementById('calendar');
      const warning = document.getElementById('warning');
      const scrollWrap = document.getElementById('scrollWrap');
      const spacer = document.getElementById('spacer');
      const modalBackdrop = document.getElementById('modalBackdrop');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      const modalClose = document.getElementById('modalClose');

      function isPhoneDevice() {
        const ua = navigator.userAgent || '';
        const mobileRe = /Mobi|Android.*Mobile|iPhone|iPod|Windows Phone|BlackBerry/i;
        if (mobileRe.test(ua)) return true;
        if (navigator.userAgentData && navigator.userAgentData.mobile) return true;
        return !!(navigator.maxTouchPoints && window.innerWidth <= 820);
      }

      if (!isPhoneDevice()) {
        warning.style.display = 'block';
        scrollWrap.style.display = 'none';
        return;
      } else {
        warning.style.display = 'none';
      }

      const now = new Date();
      const today = Math.max(1, Math.min(now.getDate(), 24));

      // CONTENTS: put your content here. Key = day number (1..24).
      // type: 'text' | 'image' | 'gif' | 'link' | 'html'
      // value: string (text, URL, or markup)
      // title: optional title shown in modal
      const CONTENTS = {
        1: { type: 'text', title: '<i> 01.12.</i>\nWelcome', value: "Fr√∂hlichen Advent!\nIch habe dich sooo lieb Maus.üñ§" },
        2: { type: 'gif', title: '<i> 02.12.</i>\nIch, wie ich diesen Kalender mache', value: 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif' },
        3: { type: 'text', title: '<i> 03.12.</i>\nGuten Morgen Maus :*', value: '‚£ø‚°ø‚†ø‚†ü‚†õ‚†õ‚¢ª‚£ã‚£ø‚†ã‚£ø‚£ø‚£ø‚£ø‚£ã‚°â‚†â‚†ô‚£ø‚†ü‚£ª‚£ø‚£ø‚£ø‚£ø‚†è‚£ø‚£ø‚£ø‚†õ‚†õ‚†ª‚†ø‚¢ø‚£ø‚£ø\n‚£ø‚£•‚£∂‚†Ä‚†â‚¢π‚°ü‚¢ª‚†ã‚£ø‚°è‚¢°‚£ø‚£ø‚£ø‚°á‚¢∏‚†Ä‚£æ‚¢©‚£ø‚£ø‚†ã‚¢†‚£º‚†Å‚†Å‚¢π‚°á‚†à‚¢≥‚£§‚†Ç‚¢†‚£ø‚£ø\n‚£ø‚£ø‚£ø‚£Ä‚£∂‚£ø‚£Å‚£à‚£º‚£ü‚£†‚£ø‚£ø‚£ø‚£ø‚£É‚£à‚£†‚£á‚°à‚¢â‚£Ö‚£à‚¢â‚£π‚£Ä‚°Ü‚¢Ä‚£ø‚£∂‚°Ä‚¢°‚£∂‚£æ‚£ø‚£ø\n‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚£ø‚°ø‚£ø‚¢ø‚°∑‚£ø‚£ø‚¢ø‚£ø‚£ø\n‚°ø‚¢ã‚†â‚†ã‚°Ñ‚¢∏‚£ø‚°è‚†à‚†ª‚¢ø‚£ø‚£ø‚°ø‚†ø‚†ø‚†ü‚†õ‚¢ø‚£ø‚£ø‚¢ã‚†Ä‚£ø‚£ø‚†Ñ‚†à‚†Ñ‚†Å‚¢Ä‚†Ñ‚†à‚¢°‚°é‚°à‚¢π\n‚£á‚°Ä‚†Ä‚†à‚¢∞‚£ø‚£ø‚†Ä‚£∑‚£Ü‚°Ä‚†à‚¢Å‚£Ä‚£∂‚£∂‚£∂‚£∂‚†Ä‚†π‚¢Å‚£æ‚†Ä‚£ø‚£∑‚£æ‚£∑‚°è‚¢ø‚°∑‚°æ‚°∑‚†é‚£Ä‚°Ä‚£æ\n‚£ø‚£ø‚£ø‚£¶‚£†‚£ø‚°á‚¢∏‚£ø‚£ø‚£ø‚£æ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°∑‚£¥‚£ø‚£ø‚†Ä‚£Ω‚£ø‚£ø‚£ø‚°Ä‚¢Ä‚£Ñ‚°§‚†Ñ‚£∞‚£ø‚£ø‚£ø\n‚£ø‚£ø‚£ø‚°ø‚£ø‚£ã‚£Ä‚†Ä‚£Ä‚£ø‚£ø‚£É‚£º‚£ø‚†ø‚†ø‚£ø‚£ø‚£Ö‚£æ‚°ø‚†ü‚†ê‚†õ‚†õ‚£ª‚£ø‚£ß‚°Ä‚†Å‚£§‚£æ‚£ø‚£ø‚£ø‚£ø\n‚£ø‚†ã‚°Ñ‚¢†‚†à‚£ü‚£â‚¢Ä‚†à‚£Å‚°†‚†ú‚£ø‚£ß‚£§‚£æ‚£ø‚£ø‚£ø‚†ü‚†í‚††‚†∂‚¢æ‚£∂‚£ø‚£ø‚£ø‚£ø‚†Ä‚†ü‚†â‚£ª‚£ø‚£ø‚£ø\n‚£ø‚†Ä‚†õ‚†ü‚£†‚£ø‚°ø‚†ø‚†Ä‚†Ä‚£†‚£§‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†õ‚††‚£Ñ‚£Ä‚£†‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†ò‚¢Ä‚£ø‚£ø‚£ø‚£ø\n‚£ø‚£ø‚£¶‚£†‚£ø‚£ø‚£∂‚£∂‚£∂‚£Ñ‚°à‚†ô‚£ø‚£ø‚£ø‚£ø‚°ø‚¢ã‚£Ä‚£¥‚£§‚£§‚£Ñ‚£Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø' },
        4: { type: 'link', title: '<i> 04.12.</i>\nHier eine sehns√ºchtige Playlist nach dir:', value: 'https://open.spotify.com/playlist/7JguPsmzxi988gHujHDPuw?si=4tKqjlWjQL2wXjZ2gVigoQ&pi=wLSMPzgUS92M9' },
        5: { type: 'image', title: '<i> 05.12.</i>\n‚ô° Danke f√ºr die ganzen wundersch√∂nen Erinnerungen ‚ô°', value: './images/halloween.jpeg' },
        6: { type: 'gif', title: '<i> 06.12.</i>\nAlles Liebe zum Nikolaus! Knutschi :**', value: './images/snow.gif' },
        7: { type: 'gif', title: '<i> 07.12.</i>\nDein Geschenk bekommest du heute pers√∂nlich, wenn wir uns sehen. Mit dir f√ºhlt sich jeder Augenblick f√ºr mich eh wie ein Geschenk an ‚ô°‚ü°Àô‚ãÜ\n', value: 'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2l4cXpibXVnb3Y4MnU3c2QweGk2bXV2d3h5OHl6d3J6cHJwZWVrcCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/xTk9ZVpnoAWBzgOCxq/giphy.gif' },
    	8: { type: 'link', title: '<i> 08.12.</i>\nEine Playlist f√ºr den Start in die Woche ùÑû‚®æìç¢÷¥‡ªãüéß‡æÄ‡Ω≤', value: 'https://open.spotify.com/playlist/2O2bUkh4j8FtVx7lC3W0Ak?si=LtF2Zk_FR06AfEzogAX-Kw&pi=BvojYGJ_R-Swg' },
        9: { type: 'gif', title: '<i> 09.12.</i>\nHeute bekommst du wieder ein Geschenk in echt\n‚ô°‚ü°Àô‚ãÜ:** ', value: 'https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExYWx0eDBnNHQ1cXV1Z292ZTIwbWtzdnZ2NGpuZTJnY2x1NTZsOW83byZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/R06WhFXLF1Fmw/giphy.gif' },
        10: { type: 'gif', title: '<i> 10.12.</i>\nNoch ein physikalisches Geschenk heute <3', value: 'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.giphy.com%2Fmedia%2FGYtaPKEARaV6E%2Fgiphy.gif&f=1&nofb=1&ipt=ed480a27957ab4ed60b7fa41c246df4e0544bc7336bac004f5a0c3a57e5338d1' },

        23: { type: 'html', title: 'Custom HTML', value: '<strong>HTML content</strong><p>Put any safe markup here.</p>' },
        24: { type: 'image', title: 'Funny GIF', value: '' },
      };

      // persistent random but static order (saved to localStorage)
      const ORDER_KEY = 'advent-calendar-order-v6';
      const OPENED_KEY = 'advent-calendar-opened-v1';
      let stored = null;
      try { stored = JSON.parse(localStorage.getItem(ORDER_KEY)); } catch (e) { stored = null; }

      // load previously opened days (array of day numbers)
      let storedOpened = null;
      try { storedOpened = JSON.parse(localStorage.getItem(OPENED_KEY)); } catch (e) { storedOpened = null; }
      const openedSet = new Set(Array.isArray(storedOpened) ? storedOpened : []);

      let days;
      if (stored && Array.isArray(stored) && stored.length === 24) {
        days = stored;
      } else {
        days = Array.from({ length: 24 }, (_, i) => i + 1);
        for (let i = days.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [days[i], days[j]] = [days[j], days[i]];
        }
        try { localStorage.setItem(ORDER_KEY, JSON.stringify(days)); } catch (e) { /* ignore */ }
      }

      // spans: restore previous spans if earlier code saved them, otherwise generate same behavior as before
      const SPANS_KEY = 'advent-calendar-spans-v1';
      let spans = null;
      try { spans = JSON.parse(localStorage.getItem(SPANS_KEY)); } catch (e) { spans = null; }
      // We enforce: only days 6 and 24 are '2x2'. Other special tiles may be
      // 'row-2' (1x2), 'col-2' (2x1), or null (1x1). We sanitize any stored
      // spans and regenerate if missing/invalid.
      const DESIRED_PAIRS = 5; // number of additional 2x1/1x2 tiles
      function buildDefaultSpans() {
        const s = Array(24).fill(null);
        function setSpan(day, type) { const idx = days.indexOf(day); if (idx >= 0) s[idx] = type; }
        setSpan(6, '2x2');
        setSpan(24, '2x2');
        const candidates = days.filter(d => d !== 6 && d !== 24);
        for (let k = 0; k < DESIRED_PAIRS && candidates.length; k++) {
          const i = Math.floor(Math.random() * candidates.length);
          const pick = candidates.splice(i,1)[0];
          const t = Math.random() < 0.5 ? 'row-2' : 'col-2';
          setSpan(pick, t);
        }
        return s;
      }

      if (!Array.isArray(spans) || spans.length !== 24) {
        spans = buildDefaultSpans();
        try { localStorage.setItem(SPANS_KEY, JSON.stringify(spans)); } catch(e){}
      } else {
        // sanitize stored spans: convert legacy booleans to '2x2', normalize values
        spans = spans.map(v => {
          if (v === true) return '2x2';
          if (v === false || v == null) return null;
          if (typeof v === 'string') {
            const ok = ['2x2','row-2','col-2'];
            return ok.includes(v) ? v : null;
          }
          return null;
        });

        // ensure only 6 and 24 are '2x2' (clear any other 2x2s)
        spans = spans.map((v, i) => {
          // map i -> day number via days array
          const day = days[i];
          if (v === '2x2' && day !== 6 && day !== 24) return null;
          return v;
        });

        // count existing row/col spans and add more if needed
        const existingPairs = spans.filter(v => v === 'row-2' || v === 'col-2').length;
        if (existingPairs < DESIRED_PAIRS) {
          const need = DESIRED_PAIRS - existingPairs;
          const candidates = days.map((d, idx) => ({d, idx})).filter(o => o.d !== 6 && o.d !== 24 && spans[o.idx] == null);
          for (let k = 0; k < need && candidates.length; k++) {
            const i = Math.floor(Math.random() * candidates.length);
            const pick = candidates.splice(i,1)[0];
            spans[pick.idx] = Math.random() < 0.5 ? 'row-2' : 'col-2';
          }
        }

        try { localStorage.setItem(SPANS_KEY, JSON.stringify(spans)); } catch(e){}
      }

      // helper to render content inside modal
      function renderContent(obj) {
        modalBody.innerHTML = '';
        if (!obj) {
          const p = document.createElement('p');
          p.textContent = 'No content for this door.';
          modalBody.appendChild(p);
          return;
        }
        const t = (obj.type || 'text').toLowerCase();
        if (t === 'text') {
          const p = document.createElement('p');
          p.textContent = obj.value;
          modalBody.appendChild(p);
        } else if (t === 'image' || t === 'gif') {
          // make the image clickable and open the source in a new tab
          const a = document.createElement('a');
          a.href = obj.value;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          const img = document.createElement('img');
          img.src = obj.value;
          img.alt = obj.title || 'Image';
          img.style.cursor = 'zoom-in';
          a.appendChild(img);
          modalBody.appendChild(a);
        } else if (t === 'link') {
          const a = document.createElement('a');
          a.href = obj.value;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          // extract domain from URL
          try {
            const url = new URL(obj.value);
            a.textContent = url.hostname;
          } catch (e) {
            a.textContent = obj.value;
          }
          modalBody.appendChild(a);
        } else if (t === 'html') {
          // insert as markup ‚Äî keep simple. Avoid unsafe content if user-provided.
          modalBody.innerHTML = obj.value;
        } else {
          const p = document.createElement('p');
          p.textContent = obj.value || 'Content';
          modalBody.appendChild(p);
        }
      }

function openModalFor(day) {
        const obj = CONTENTS[day] || { type: 'text', title: `Day ${day}`, value: `Content for day ${day}` };
        const title = obj.title || `Day ${day}`;
        // convert \n to <br> for proper line breaks in title
        modalTitle.innerHTML = title.replace(/\n/g, '<br>');
        renderContent(obj);
        modalBackdrop.style.display = 'flex';
        modalBackdrop.setAttribute('aria-hidden', 'false');

        // attempt to shrink text so it fits the modal without scrolling
        // we run after showing so measurements are accurate
        (function fitModalContent() {
          const modalEl = modalBackdrop.querySelector('.modal');
          const bodyEl = modalBody;
          if (!modalEl || !bodyEl) {
            modalClose.focus();
            return;
          }

          // reset any previous sizing
          bodyEl.style.fontSize = '';

          function contentOverflows() {
            // allow a tiny tolerance (4px)
            const overV = bodyEl.scrollHeight > (modalEl.clientHeight - 4);
            const overH = bodyEl.scrollWidth > (modalEl.clientWidth - 4);
            return overV || overH;
          }

          function shrinkUntilFits() {
            const style = window.getComputedStyle(bodyEl);
            // start from computed size (may be '12px' etc.)
            let current = parseFloat(style.fontSize) || 16;
            const min = 10; // don't shrink smaller than 10px
            let iterations = 0;
            while (contentOverflows() && current > min && iterations < 25) {
              current = Math.max(min, current - 1);
              bodyEl.style.fontSize = current + 'px';
              iterations++;
            }
            // if still overflows, try a small overall scale as a last resort
            if (contentOverflows()) {
              let scale = 0.98;
              let tries = 0;
              bodyEl.style.transformOrigin = 'top center';
              while (contentOverflows() && tries < 8) {
                bodyEl.style.transform = `scale(${scale})`;
                scale -= 0.02;
                tries++;
              }
            } else {
              // ensure transform is cleared if we fit with font-size
              bodyEl.style.transform = '';
            }
          }

          // If images exist, wait for them to load before final shrinking
          const imgs = Array.from(bodyEl.querySelectorAll('img'));
          if (imgs.length === 0) {
            shrinkUntilFits();
            modalClose.focus();
            return;
          }

          let pending = imgs.length;
          const onLoaded = () => {
            pending--;
            if (pending <= 0) {
              shrinkUntilFits();
              modalClose.focus();
            }
          };
          imgs.forEach(img => {
            if (img.complete) onLoaded();
            else img.addEventListener('load', onLoaded, { once: true });
            img.addEventListener('error', onLoaded, { once: true });
          });
          // fallback: if images don't fire quickly, run shrink after 250ms
          setTimeout(() => { if (pending > 0) { shrinkUntilFits(); modalClose.focus(); } }, 250);
        })();
      }

      function closeModal() {
        modalBackdrop.style.display = 'none';
        modalBackdrop.setAttribute('aria-hidden', 'true');
        // clear any font-size/transform adjustments we made when opening
        modalBody.style.fontSize = '';
        modalBody.style.transform = '';
      }

      modalClose.addEventListener('click', closeModal);
      modalBackdrop.addEventListener('click', (ev) => {
        if (ev.target === modalBackdrop) closeModal();
      });
      window.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') closeModal();
      });

      // Build grid tiles and attach modal-opening handlers
      calendar.innerHTML = '';
      days.forEach((d, idx) => {
        const door = document.createElement('button');
        door.type = 'button';
        door.className = 'door';
        door.textContent = d;
        door.setAttribute('aria-label', `Open day ${d}`);

        const spanType = spans[idx];
        if (spanType === '2x2') door.classList.add('span-2x2');
        else if (spanType === 'row-2') door.classList.add('span-row-2');
        else if (spanType === 'col-2') door.classList.add('span-col-2');

        if (d > today) {
          door.disabled = true;
          door.setAttribute('aria-disabled', 'true');
        } else {
          if (openedSet.has(d)) door.classList.add('opened');

          door.addEventListener('click', function () {
            // open modal with content (rather than alert)
            openModalFor(d);

            // record as opened when user views content
            if (!openedSet.has(d)) {
              openedSet.add(d);
              door.classList.add('opened');
              try { localStorage.setItem(OPENED_KEY, JSON.stringify(Array.from(openedSet))); } catch(e){}
            }
          });
        }

        calendar.appendChild(door);
      });

      // compute --cell-size so tiles are square and fill vertical space exactly
      const ROWS = 3;
      const GAP_PX = 10;
      function updateCellSize() {
        const calH = calendar.clientHeight;
        if (!calH) return;
        const totalGaps = (ROWS - 1) * GAP_PX;
        const size = Math.floor((calH - totalGaps) / ROWS);
        document.documentElement.style.setProperty('--cell-size', size + 'px');
        updateSpacer();
      }

      function updateSpacer() {
        const maxScrollLeft = Math.max(0, scrollWrap.scrollWidth - scrollWrap.clientWidth);
        const vh = document.documentElement.clientHeight || window.innerHeight;
        const needed = maxScrollLeft + vh;
        spacer.style.height = Math.ceil(needed) + 'px';
      }

      function onScroll() {
        const maxY = Math.max(0, spacer.offsetHeight - window.innerHeight);
        const y = Math.max(0, Math.min(window.scrollY, maxY));
        const frac = maxY === 0 ? 0 : (y / maxY);
        const maxScrollLeft = Math.max(0, scrollWrap.scrollWidth - scrollWrap.clientWidth);
        scrollWrap.scrollLeft = Math.round(maxScrollLeft * frac);
      }

      // initial sizing and sync
      function initialSetup() {
        requestAnimationFrame(() => {
          updateCellSize();
          window.scrollTo(0,0);
          onScroll();
        });
      }
      initialSetup();

      const ro = new ResizeObserver(() => { updateCellSize(); onScroll(); });
      ro.observe(scrollWrap);
      ro.observe(calendar);
      window.addEventListener('resize', updateCellSize);
      window.addEventListener('scroll', onScroll, { passive: true });

      // wheel over viewport -> move page scroll (maps to horizontal)
      window.addEventListener('wheel', (ev) => {
        if (scrollWrap.scrollWidth <= scrollWrap.clientWidth) return;
        if (Math.abs(ev.deltaY) > Math.abs(ev.deltaX)) {
          window.scrollBy({ top: ev.deltaY, behavior: 'auto' });
          ev.preventDefault();
        }
      }, { passive: false });

    })();
  </script>
</body>
</html>